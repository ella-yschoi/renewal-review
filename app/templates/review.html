{% extends "base.html" %}
{% block title %}{{ result.policy_number }} — Renewal Review{% endblock %}

{% block content %}
<div style="margin-bottom:16px;">
  <a href="/" style="color:#3182ce; font-size:13px;">← Back to Dashboard</a>
</div>

<div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:16px;">
  <h1 style="font-size:20px;">{{ result.policy_number }}</h1>
  <span class="badge badge-{{ result.risk_level.value }}" style="font-size:14px; padding:4px 12px;">
    {{ result.risk_level.value }}
  </span>
</div>

<div class="card">
  <h2>Summary</h2>
  <p style="font-size:13px; color:#4a5568;">{{ result.summary }}</p>
</div>

{% if result.diff.flags %}
<div class="card">
  <h2>Flags ({{ result.diff.flags|length }})</h2>
  <div style="display:flex; flex-wrap:wrap; gap:6px;">
    {% for flag in result.diff.flags %}
    <span class="flag-tag">{{ flag.value }}</span>
    {% endfor %}
  </div>
</div>
{% endif %}

<div class="card">
  <h2>Field Changes ({{ result.diff.changes|length }})</h2>
  <table>
    <thead>
      <tr><th>Field</th><th>Prior</th><th>Renewal</th><th>Change %</th><th>Flag</th></tr>
    </thead>
    <tbody>
      {% for c in result.diff.changes %}
      <tr>
        <td style="font-weight:500;">{{ c.field }}</td>
        <td>{{ c.prior_value or "—" }}</td>
        <td>{{ c.renewal_value or "—" }}</td>
        <td>{% if c.change_pct is not none %}{{ "%.1f"|format(c.change_pct) }}%{% else %}—{% endif %}</td>
        <td>{% if c.flag %}<span class="flag-tag">{{ c.flag.value }}</span>{% endif %}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

{% if result.llm_insights %}
<div class="card">
  <h2>LLM Insights ({{ result.llm_insights|length }})</h2>
  <table>
    <thead>
      <tr><th>Type</th><th>Finding</th><th>Confidence</th><th>Reasoning</th></tr>
    </thead>
    <tbody>
      {% for i in result.llm_insights %}
      <tr>
        <td><span class="flag-tag">{{ i.analysis_type }}</span></td>
        <td>{{ i.finding }}</td>
        <td>{{ "%.0f"|format(i.confidence * 100) }}%</td>
        <td style="font-size:12px; color:#718096;">{{ i.reasoning }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endif %}
{% endblock %}
